images:
  - name: ghcr.io/ionos-cloud/cluster-api-provider-ionoscloud:e2e
providers:
  - name: cluster-api
    type: CoreProvider
    version:
    - name: "{go://sigs.k8s.io/cluster-api@v1.6}"
      value: "https://github.com/kubernetes-sigs/cluster-api/releases/download/{go://sigs.k8s.io/cluster-api@v1.6}/core-components.yaml"
      type: url
      contract: v1beta1
      replacements:
        - old: --metrics-addr=127.0.0.1:8080
          new: --metrics-addr=:8080
      files:
        - sourcePath: "../data/shared/v1.6/metadata.yaml"
  - name: kubeadm
    type: BootstrapProvider
    version:
    - name: "{go://sigs.k8s.io/cluster-api@v1.6}"
      value: "https://github.com/kubernetes-sigs/cluster-api/releases/download/{go://sigs.k8s.io/cluster-api@v1.6}/bootstrap-components.yaml"
      type: url
      contract: v1beta1
      replacements:
        - old: --metrics-addr=127.0.0.1:8080
          new: --metrics-addr=:8080
      files:
        - sourcePath: "../data/shared/v1.6/metadata.yaml"
  - name: kubeadm
    type: ControlPlaneProvider
    version:
      - name: "{go://sigs.k8s.io/cluster-api@v1.6}"
        value: "https://github.com/kubernetes-sigs/cluster-api/releases/download/{go://sigs.k8s.io/cluster-api@v1.6}/control-plane-components.yaml"
        type: url
        contract: v1beta1
        replacements:
          - old: --metrics-addr=127.0.0.1:8080
            new: --metrics-addr=:8080
        files:
          - sourcePath: "../data/shared/v1.6/metadata.yaml"
  - name: ionoscloud
    type: InfrastructureProvider
    version:
      - name: "{go://github.com/ionos-cloud/cluster-api-provider-ionoscloud@v0.1}"
        value: "../../config/default"
        replacements:
          - old: ghcr.io/ionos-cloud/cluster-api-provider-ionoscloud:dev
            new: ghcr.io/ionos-cloud/cluster-api-provider-ionoscloud:e2e
          - old: "--leader-elect"
            new: "--leader-elect\n        --metrics-addr=:8080\n        --insecure-diagnostics"
        files:
          - sourcePath: "../../metadata.yaml"
          - sourcePath: "../data/infrastructure-ionoscloud/cluster-template.yaml"
variables:
  # Default variables for the e2e test; those values could be overridden via env variables, thus
  # allowing the same e2e config file to be re-used in different Prow jobs e.g. each one with a K8s version permutation.
  # The following Kubernetes versions should be the latest versions with already published kindest/node images.
  # This avoids building node images in the default case which improves the test duration significantly.
  KUBERNETES_VERSION_MANAGEMENT: "v1.30.0"
  KUBERNETES_VERSION: "v1.30.0"
#  IONOS_TOKEN: "${IONOS_TOKEN:-}"
  CNI: "./data/cni/calico.yaml"
  CLUSTER_NAME: "e2e-cluster-${RANDOM}"
#  CONTROL_PLANE_ENDPOINT_IP: "${CONTROL_PLANE_ENDPOINT_IP:-}"
  IONOSCLOUD_MACHINE_IMAGE_ID: "fd212368-0883-11ef-bd99-229bb3119020"


intervals:
  default/wait-controllers: [ "20m", "10s" ]
  default/wait-cluster: [ "20m", "10s" ]
  default/wait-control-plane: [ "10m", "10s" ]
  default/wait-worker-nodes: [ "20m", "10s" ]
  default/wait-delete-cluster: [ "3m", "10s" ]
  default/wait-nodes-ready: ["10m", "10s"]
  scale/wait-cluster: ["10m", "10s"]
  scale/wait-control-plane: ["20m", "10s"]
  scale/wait-worker-nodes: ["20m", "10s"]
